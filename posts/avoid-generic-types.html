<!DOCTYPE html><html lang="en"><head><meta content="#1976d2" name="theme-color"/><meta charSet="utf-8"/><meta content="initial-scale=1, width=device-width" name="viewport"/><link href="https://www.nigel-schuster.de/posts/avoid-generic-types" rel="canonical"/><link href="/favicon/apple-touch-icon.png" sizes="180x180"/><link href="/favicon/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"/><link href="/favicon/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"/><link href="/favicon/site.webmanifest" rel="manifest"/><link color="#000000" href="/favicon/safari-pinned-tab.svg"/><link href="/favicon/favicon.ico" rel="icon"/><meta content="#000000" name="msapplication-TileColor"/><meta content="/favicon/browserconfig.xml" name="msapplication-config"/><meta content="#000" name="theme-color"/><link href="/feed.xml" rel="alternate" type="application/rss+xml"/><script async="" data-goatcounter="https://nigel.goatcounter.com/count" data-goatcounter-settings="{}" src="//gc.zgo.at/count.js"></script><title>Avoiding generic types for safer code</title><meta content="" name="description"/><meta content="Avoiding generic types for safer code" property="og:title"/><meta content="" property="og:description"/><meta content="article" property="og:type"/><meta content="en_US" property="og:locale"/><meta name="next-head-count" content="20"/><link rel="preload" href="/_next/static/css/727973242bb33abd.css" as="style"/><link rel="stylesheet" href="/_next/static/css/727973242bb33abd.css" data-n-g=""/><link rel="preload" href="/_next/static/css/2aec7fdc1f1ca4ae.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2aec7fdc1f1ca4ae.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-49db52efeac3c2ff.js" defer=""></script><script src="/_next/static/chunks/framework-9f60f5fdccf280ab.js" defer=""></script><script src="/_next/static/chunks/main-a541d5cb0a96160b.js" defer=""></script><script src="/_next/static/chunks/pages/_app-1d757137bf9cdde6.js" defer=""></script><script src="/_next/static/chunks/148-63709ba831587baa.js" defer=""></script><script src="/_next/static/chunks/805-87bf7ab9dc742169.js" defer=""></script><script src="/_next/static/chunks/933-b5375bb1923d034b.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-1b24523711a67598.js" defer=""></script><script src="/_next/static/xe9nAKT4rv0d4tn_7yU62/_buildManifest.js" defer=""></script><script src="/_next/static/xe9nAKT4rv0d4tn_7yU62/_ssgManifest.js" defer=""></script><script src="/_next/static/xe9nAKT4rv0d4tn_7yU62/_middlewareManifest.js" defer=""></script><style data-emotion="css-global o6gwfi">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><style data-emotion="css 1qsxih2 wpxufe s18byi rhsghg 1qw96cp k008qs i9gxme lq9rk4 56sg73 6uhfkt 3i9vrz 1hy9t21 9iedg7 1bw4yx3 1f04t6y g8y262 1jluznr 1qeofn3 9l3uo3 jo3ec3 19t329g">.css-1qsxih2{width:100%;margin-left:auto;box-sizing:border-box;margin-right:auto;display:block;padding-left:16px;padding-right:16px;}@media (min-width:600px){.css-1qsxih2{padding-left:24px;padding-right:24px;}}@media (min-width:1200px){.css-1qsxih2{max-width:1200px;}}.css-wpxufe{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:300;font-size:3.5rem;line-height:1.167;letter-spacing:-0.01562em;color:inherit;-webkit-text-decoration:none;text-decoration:none;}@media (min-width:600px){.css-wpxufe{font-size:4.7129rem;}}@media (min-width:900px){.css-wpxufe{font-size:5.3556rem;}}@media (min-width:1200px){.css-wpxufe{font-size:5.9983rem;}}.css-s18byi{background-color:#fff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;border-radius:4px;box-shadow:0px 2px 1px -1px rgba(0,0,0,0.2),0px 1px 1px 0px rgba(0,0,0,0.14),0px 1px 3px 0px rgba(0,0,0,0.12);overflow:hidden;}.css-rhsghg{display:block;-webkit-background-size:cover;background-size:cover;background-repeat:no-repeat;-webkit-background-position:center;background-position:center;width:100%;object-fit:cover;}.css-1qw96cp{padding:16px;}.css-1qw96cp:last-child{padding-bottom:24px;}.css-k008qs{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}.css-i9gxme{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}.css-lq9rk4{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:2rem;line-height:1.167;letter-spacing:0em;}@media (min-width:600px){.css-lq9rk4{font-size:2.5707rem;}}@media (min-width:900px){.css-lq9rk4{font-size:2.7849rem;}}@media (min-width:1200px){.css-lq9rk4{font-size:2.9991rem;}}.css-56sg73{-webkit-align-self:flex-end;-ms-flex-item-align:flex-end;align-self:flex-end;}.css-6uhfkt{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;font-family:"Roboto","Helvetica","Arial",sans-serif;font-size:0.8125rem;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;height:32px;color:rgba(0, 0, 0, 0.87);background-color:rgba(0, 0, 0, 0.08);border-radius:16px;white-space:nowrap;-webkit-transition:background-color 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;cursor:default;outline:0;-webkit-text-decoration:none;text-decoration:none;border:0;padding:0;vertical-align:middle;box-sizing:border-box;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent;cursor:pointer;}.css-6uhfkt::-moz-focus-inner{border-style:none;}.css-6uhfkt.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-6uhfkt{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-6uhfkt.Mui-disabled{opacity:0.38;pointer-events:none;}.css-6uhfkt .MuiChip-avatar{margin-left:5px;margin-right:-6px;width:24px;height:24px;color:#616161;font-size:0.75rem;}.css-6uhfkt .MuiChip-avatarColorPrimary{color:#fff;background-color:#1565c0;}.css-6uhfkt .MuiChip-avatarColorSecondary{color:#fff;background-color:#7b1fa2;}.css-6uhfkt .MuiChip-avatarSmall{margin-left:4px;margin-right:-4px;width:18px;height:18px;font-size:0.625rem;}.css-6uhfkt .MuiChip-icon{color:#616161;margin-left:5px;margin-right:-6px;}.css-6uhfkt .MuiChip-deleteIcon{-webkit-tap-highlight-color:transparent;color:rgba(0, 0, 0, 0.26);font-size:22px;cursor:pointer;margin:0 5px 0 -6px;}.css-6uhfkt .MuiChip-deleteIcon:hover{color:rgba(0, 0, 0, 0.4);}.css-6uhfkt:hover{background-color:rgba(0, 0, 0, 0.12);}.css-6uhfkt.Mui-focusVisible{background-color:rgba(0, 0, 0, 0.2);}.css-6uhfkt:active{box-shadow:0px 2px 1px -1px rgba(0,0,0,0.2),0px 1px 1px 0px rgba(0,0,0,0.14),0px 1px 3px 0px rgba(0,0,0,0.12);}.css-3i9vrz{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:40px;height:40px;font-family:"Roboto","Helvetica","Arial",sans-serif;font-size:1.25rem;line-height:1;border-radius:50%;overflow:hidden;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}.css-1hy9t21{width:100%;height:100%;text-align:center;object-fit:cover;color:transparent;text-indent:10000px;}.css-9iedg7{overflow:hidden;text-overflow:ellipsis;padding-left:12px;padding-right:12px;white-space:nowrap;}.css-1bw4yx3{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;font-style:italic;padding-bottom:1.5em;}.css-1f04t6y{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1.5625rem;line-height:1.235;letter-spacing:0.00735em;}@media (min-width:600px){.css-1f04t6y{font-size:1.8219rem;}}@media (min-width:900px){.css-1f04t6y{font-size:2.0243rem;}}@media (min-width:1200px){.css-1f04t6y{font-size:2.0243rem;}}.css-g8y262{width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-flow:column wrap;-webkit-flex-flow:column wrap;-ms-flex-flow:column wrap;flex-flow:column wrap;-webkit-align-content:space-between;-ms-flex-line-pack:space-between;align-content:space-between;box-sizing:border-box;}.css-g8y262>*{box-sizing:border-box;}@media (min-width:0px){.css-g8y262{margin:-4px;}.css-g8y262>*{margin:4px;width:calc(100.00% - 8px);}}@media (min-width:600px){.css-g8y262{margin:-4px;}.css-g8y262>*{margin:4px;width:calc(50.00% - 8px);}}@media (min-width:900px){.css-g8y262{margin:-8px;}.css-g8y262>*{margin:8px;width:calc(50.00% - 16px);}}.css-1jluznr{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;display:block;text-align:inherit;width:100%;}.css-1jluznr::-moz-focus-inner{border-style:none;}.css-1jluznr.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-1jluznr{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-1jluznr:hover .MuiCardActionArea-focusHighlight{opacity:0.04;}@media (hover: none){.css-1jluznr:hover .MuiCardActionArea-focusHighlight{opacity:0;}}.css-1jluznr.Mui-focusVisible .MuiCardActionArea-focusHighlight{opacity:0.12;}.css-1qeofn3{margin:0;color:inherit;-webkit-text-decoration:none;text-decoration:none;}.css-9l3uo3{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;}.css-jo3ec3{overflow:hidden;pointer-events:none;position:absolute;top:0;right:0;bottom:0;left:0;border-radius:inherit;opacity:0;background-color:currentcolor;-webkit-transition:opacity 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:opacity 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.css-19t329g{margin:0;color:inherit;-webkit-text-decoration:underline;text-decoration:underline;}.css-19t329g:hover{text-decoration-color:inherit;}</style></head><body><div id="__next" data-reactroot=""><div class="min-h-screen"><main><div class="MuiContainer-root MuiContainer-maxWidthLg css-1qsxih2"><a class="MuiTypography-root MuiTypography-h1 MuiLink-root MuiLink-underlineNone css-wpxufe" href="/">Yet another SWE Blog.</a><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation1 MuiCard-root css-s18byi"><img class="MuiCardMedia-root MuiCardMedia-media MuiCardMedia-img css-rhsghg"/><div class="MuiCardContent-root css-1qw96cp"><div class="MuiBox-root css-k008qs"><div class="MuiBox-root css-i9gxme"><h1 class="MuiTypography-root MuiTypography-h3 css-lq9rk4">Avoiding generic types for safer code</h1></div><div class="MuiBox-root css-56sg73"><div class="MuiButtonBase-root MuiChip-root MuiChip-filled MuiChip-sizeMedium MuiChip-colorDefault MuiChip-clickable MuiChip-clickableColorDefault MuiChip-filledDefault css-6uhfkt" tabindex="0" href="/author/nigel-schuster"><div class="MuiAvatar-root MuiAvatar-circular MuiChip-avatar MuiChip-avatarMedium MuiChip-avatarColorDefault css-3i9vrz"><img alt="Nigel Schuster" src="https://media.graphcms.com/resize=fit:crop,height:100,width:100/1bF1qLxsSbElgNK5x6t6" class="MuiAvatar-img css-1hy9t21"/></div><span class="MuiChip-label MuiChip-labelMedium css-9iedg7">Nigel Schuster</span></div></div></div><p>Generic types like <code>int</code> or <code>string</code> are quick and easy to use. However, sometimes they represent a specific concept. Declaring a new type is an easy way to avoid confusion. Let&#x27;s look at the following code:</p>
<pre><code class="hljs language-rust"><span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title hljs-function">rectangle_circumference</span>(width: <span class="hljs-type">u32</span>, height: <span class="hljs-type">u32</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">u32</span> {
    <span class="hljs-number">2</span> * width + <span class="hljs-number">2</span> * height
}
</code></pre>
<p>This code is meant to calculate the circumference of some arbitrary rectangle. It is simple and universally usable. However, it is very easy to use incorrectly. We have no guarantee that the units are all the same. <code>width</code> could be in centimeters, while <code>height</code> is in meters. To alleviate this problem, we can declare a specific type for a unit:</p>
<pre><code class="hljs language-rust"><span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title hljs-class">Meter</span>(<span class="hljs-keyword">pub</span> <span class="hljs-type">u32</span>);
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title hljs-function">rectangle_circumference</span>(width: Meter, height: Meter) <span class="hljs-punctuation">-&gt;</span> Meter {
    <span class="hljs-title hljs-function hljs-invoke">Meter</span>(<span class="hljs-number">2</span> * width.<span class="hljs-number">0</span> + <span class="hljs-number">2</span> * height.<span class="hljs-number">0</span>)
}
</code></pre>
<p>With this, we now put the burden on the caller to ensure that both inputs are of type <code>Meter</code>, and we guarantee that the output is of type <code>Meter</code> as well. At first sight, you may think that this incurs some overhead, however, the Godbolt output is the same for both versions when using <code>-C opt-level=3</code>:</p>
<pre><code class="hljs language-x86asm"><span class="hljs-symbol">example:</span>:rectangle_circumference:
        <span class="hljs-keyword">add</span>     <span class="hljs-built_in">edi</span>, <span class="hljs-built_in">esi</span>
        <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">eax</span>, [<span class="hljs-built_in">rdi</span> + <span class="hljs-built_in">rdi</span>]
        <span class="hljs-keyword">ret</span>
</code></pre>
<p>Of course, we should consider making this more generic while maintaining precise types:</p>
<pre><code class="hljs language-rust"><span class="hljs-keyword">pub</span> <span class="hljs-keyword">trait</span> <span class="hljs-title hljs-class">LengthUnit</span> {}

<span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title hljs-class">Rectangle</span>&lt;T: LengthUnit&gt; {
    width: T,
    height: T,
}

<span class="hljs-keyword">impl</span>&lt;T: LengthUnit&gt; Rectangle&lt;T&gt;
<span class="hljs-keyword">where</span>
    T: std::ops::Add&lt;Output = T&gt; + <span class="hljs-built_in">Copy</span>,
{
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title hljs-function">circumference</span>(<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> T {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"></span><span class="hljs-variable">Rectangle</span> { width, height } = <span class="hljs-keyword">self</span>;
        width + width + height + height
    }
}

<span class="hljs-meta">#[derive(Clone, Copy)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title hljs-class">Meter</span>(<span class="hljs-type">u32</span>);
<span class="hljs-keyword">impl</span> <span class="hljs-title hljs-class">LengthUnit</span> <span class="hljs-keyword">for</span> <span class="hljs-title hljs-class">Meter</span> {}
<span class="hljs-keyword">impl</span> <span class="hljs-title hljs-class">std</span>::ops::Add <span class="hljs-keyword">for</span> <span class="hljs-title hljs-class">Meter</span> {
    <span class="hljs-keyword">type</span> <span class="hljs-title hljs-class">Output</span> = Meter;
    <span class="hljs-keyword">fn</span> <span class="hljs-title hljs-function">add</span>(<span class="hljs-keyword">self</span>, rhs: <span class="hljs-keyword">Self</span>) <span class="hljs-punctuation">-&gt;</span> Meter {
        <span class="hljs-title hljs-function hljs-invoke">Meter</span>(<span class="hljs-keyword">self</span>.<span class="hljs-number">0</span> + rhs.<span class="hljs-number">0</span>)
    }
}
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title hljs-function">rectangle_circumference</span>&lt;T&gt;(width: T, height: T) <span class="hljs-punctuation">-&gt;</span> T
<span class="hljs-keyword">where</span>
    T: LengthUnit + <span class="hljs-built_in">Copy</span> + std::ops::Add&lt;Output = T&gt;,
{
    (Rectangle { width, height }).<span class="hljs-title hljs-function hljs-invoke">circumference</span>()
}
</code></pre>
<p>And even this code compiles down to the same assembly in Gobolt when calling it with <code>Meter(u32)</code> input.</p>
<h3>Bonus</h3>
<p>Rust makes it particularly easy for us to deal with different units. You can design a <code>create</code> function for the rectangle to account for different types:</p>
<pre><code class="hljs language-rust"><span class="hljs-keyword">impl</span>&lt;T: LengthUnit&gt; Rectangle&lt;T&gt; {
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title hljs-function">create</span>&lt;W, H&gt;(width: W, height: H) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span>
    <span class="hljs-keyword">where</span>
        W: std::convert::<span class="hljs-built_in">Into</span>&lt;T&gt;,
        H: std::convert::<span class="hljs-built_in">Into</span>&lt;T&gt;,
    {
        <span class="hljs-keyword">Self</span> {
            width: width.<span class="hljs-title hljs-function hljs-invoke">into</span>(),
            height: height.<span class="hljs-title hljs-function hljs-invoke">into</span>(),
        }
    }
}
</code></pre>
<p>This allows us to write the following program:</p>
<pre><code class="hljs language-rust"><span class="hljs-meta">#[derive(Clone, Copy, Eq, PartialEq, Debug)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title hljs-class">Meter</span>(<span class="hljs-type">u32</span>);
...
<span class="hljs-meta">#[derive(Clone, Copy)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title hljs-class">Centimeter</span>(<span class="hljs-type">u32</span>);
<span class="hljs-keyword">impl</span> <span class="hljs-title hljs-class">LengthUnit</span> <span class="hljs-keyword">for</span> <span class="hljs-title hljs-class">Centimeter</span> {}
<span class="hljs-keyword">impl</span> <span class="hljs-title hljs-class">std</span>::convert::<span class="hljs-built_in">Into</span>&lt;Meter&gt; <span class="hljs-keyword">for</span> <span class="hljs-title hljs-class">Centimeter</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title hljs-function">into</span>(<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> Meter {
        <span class="hljs-title hljs-function hljs-invoke">Meter</span>(<span class="hljs-keyword">self</span>.<span class="hljs-number">0</span> / <span class="hljs-number">100</span>)
    }
}
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title hljs-function">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"></span><span class="hljs-variable">width</span> = <span class="hljs-title hljs-function hljs-invoke">Meter</span>(<span class="hljs-number">3</span>);
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"></span><span class="hljs-variable">height</span> = <span class="hljs-title hljs-function hljs-invoke">Centimeter</span>(<span class="hljs-number">300</span>);
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"></span><span class="hljs-variable">circumference</span>: Meter = (Rectangle::<span class="hljs-title hljs-function hljs-invoke">create</span>(
        width,
        height,
    ))
    .<span class="hljs-title hljs-function hljs-invoke">circumference</span>();
    <span class="hljs-built_in">assert_eq!</span>(circumference, <span class="hljs-title hljs-function hljs-invoke">Meter</span>(<span class="hljs-number">12</span>));
}
</code></pre><p class="MuiTypography-root MuiTypography-body1 css-1bw4yx3">Published on <!-- -->2021-08-30<!-- -->.</p></div></div><hr class="border-accent-2 mt-28 mb-24"/><div><h4 class="MuiTypography-root MuiTypography-h4 css-1f04t6y">More Stories</h4><div class="MuiMasonry-root css-g8y262"><div><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation1 MuiCard-root css-s18byi"><img class="MuiCardMedia-root MuiCardMedia-media MuiCardMedia-img css-rhsghg"/><div class="MuiCardContent-root css-1qw96cp"><button class="MuiButtonBase-root MuiCardActionArea-root css-1jluznr" tabindex="0" type="button"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineNone css-1qeofn3" href="/posts/systemd-frustration"><div class="MuiBox-root css-k008qs"><div class="MuiBox-root css-i9gxme"><h4 class="MuiTypography-root MuiTypography-h4 css-1f04t6y">Systemd Services are frustratingly hard to make safe</h4></div><div class="MuiBox-root css-56sg73"><div class="MuiButtonBase-root MuiChip-root MuiChip-filled MuiChip-sizeMedium MuiChip-colorDefault MuiChip-clickable MuiChip-clickableColorDefault MuiChip-filledDefault css-6uhfkt" tabindex="0" href="/author/nigel-schuster"><div class="MuiAvatar-root MuiAvatar-circular MuiChip-avatar MuiChip-avatarMedium MuiChip-avatarColorDefault css-3i9vrz"><img alt="Nigel Schuster" src="https://media.graphcms.com/resize=fit:crop,height:100,width:100/1bF1qLxsSbElgNK5x6t6" class="MuiAvatar-img css-1hy9t21"/></div><span class="MuiChip-label MuiChip-labelMedium css-9iedg7">Nigel Schuster</span></div></div></div><p class="MuiTypography-root MuiTypography-body1 css-9l3uo3">This article takes a dive into what it takes to set up a systemd service with the principle of least privilege.</p></a><span class="MuiCardActionArea-focusHighlight css-jo3ec3"></span></button></div></div></div><div><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation1 MuiCard-root css-s18byi"><img class="MuiCardMedia-root MuiCardMedia-media MuiCardMedia-img css-rhsghg"/><div class="MuiCardContent-root css-1qw96cp"><button class="MuiButtonBase-root MuiCardActionArea-root css-1jluznr" tabindex="0" type="button"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineNone css-1qeofn3" href="/posts/variants-are-powerful"><div class="MuiBox-root css-k008qs"><div class="MuiBox-root css-i9gxme"><h4 class="MuiTypography-root MuiTypography-h4 css-1f04t6y">Variants are incredibly powerful</h4></div><div class="MuiBox-root css-56sg73"><div class="MuiButtonBase-root MuiChip-root MuiChip-filled MuiChip-sizeMedium MuiChip-colorDefault MuiChip-clickable MuiChip-clickableColorDefault MuiChip-filledDefault css-6uhfkt" tabindex="0" href="/author/nigel-schuster"><div class="MuiAvatar-root MuiAvatar-circular MuiChip-avatar MuiChip-avatarMedium MuiChip-avatarColorDefault css-3i9vrz"><img alt="Nigel Schuster" src="https://media.graphcms.com/resize=fit:crop,height:100,width:100/1bF1qLxsSbElgNK5x6t6" class="MuiAvatar-img css-1hy9t21"/></div><span class="MuiChip-label MuiChip-labelMedium css-9iedg7">Nigel Schuster</span></div></div></div><p class="MuiTypography-root MuiTypography-body1 css-9l3uo3">Variants are an incredibly powerful tool to express the state of your program!</p></a><span class="MuiCardActionArea-focusHighlight css-jo3ec3"></span></button></div></div></div></div></div></div></main></div><footer><div class="MuiContainer-root MuiContainer-maxWidthLg css-1qsxih2"><p class="MuiTypography-root MuiTypography-body1 css-9l3uo3">Built with NextJS. Find the source <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-19t329g" href="https://github.com/Neitsch/neitsch.github.io">here</a>.</p></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"__typename":"Post","title":"Avoiding generic types for safer code","slug":"avoid-generic-types","content":"Generic types like `int` or `string` are quick and easy to use. However, sometimes they represent a specific concept. Declaring a new type is an easy way to avoid confusion. Let's look at the following code:\n```rust\npub fn rectangle_circumference(width: u32, height: u32) -\u003e u32 {\n    2 * width + 2 * height\n}\n```\nThis code is meant to calculate the circumference of some arbitrary rectangle. It is simple and universally usable. However, it is very easy to use incorrectly. We have no guarantee that the units are all the same. `width` could be in centimeters, while `height` is in meters. To alleviate this problem, we can declare a specific type for a unit:\n```rust\npub struct Meter(pub u32);\npub fn rectangle_circumference(width: Meter, height: Meter) -\u003e Meter {\n    Meter(2 * width.0 + 2 * height.0)\n}\n```\nWith this, we now put the burden on the caller to ensure that both inputs are of type `Meter`, and we guarantee that the output is of type `Meter` as well. At first sight, you may think that this incurs some overhead, however, the Godbolt output is the same for both versions when using `-C opt-level=3`:\n```x86asm\nexample::rectangle_circumference:\n        add     edi, esi\n        lea     eax, [rdi + rdi]\n        ret\n```\n\nOf course, we should consider making this more generic while maintaining precise types:\n```rust\npub trait LengthUnit {}\n\npub struct Rectangle\u003cT: LengthUnit\u003e {\n    width: T,\n    height: T,\n}\n\nimpl\u003cT: LengthUnit\u003e Rectangle\u003cT\u003e\nwhere\n    T: std::ops::Add\u003cOutput = T\u003e + Copy,\n{\n    pub fn circumference(self) -\u003e T {\n        let Rectangle { width, height } = self;\n        width + width + height + height\n    }\n}\n\n#[derive(Clone, Copy)]\nstruct Meter(u32);\nimpl LengthUnit for Meter {}\nimpl std::ops::Add for Meter {\n    type Output = Meter;\n    fn add(self, rhs: Self) -\u003e Meter {\n        Meter(self.0 + rhs.0)\n    }\n}\npub fn rectangle_circumference\u003cT\u003e(width: T, height: T) -\u003e T\nwhere\n    T: LengthUnit + Copy + std::ops::Add\u003cOutput = T\u003e,\n{\n    (Rectangle { width, height }).circumference()\n}\n```\nAnd even this code compiles down to the same assembly in Gobolt when calling it with `Meter(u32)` input. \n\n### Bonus\nRust makes it particularly easy for us to deal with different units. You can design a `create` function for the rectangle to account for different types:\n```rust\nimpl\u003cT: LengthUnit\u003e Rectangle\u003cT\u003e {\n    pub fn create\u003cW, H\u003e(width: W, height: H) -\u003e Self\n    where\n        W: std::convert::Into\u003cT\u003e,\n        H: std::convert::Into\u003cT\u003e,\n    {\n        Self {\n            width: width.into(),\n            height: height.into(),\n        }\n    }\n}\n```\nThis allows us to write the following program:\n```rust\n#[derive(Clone, Copy, Eq, PartialEq, Debug)]\nstruct Meter(u32);\n...\n#[derive(Clone, Copy)]\nstruct Centimeter(u32);\nimpl LengthUnit for Centimeter {}\nimpl std::convert::Into\u003cMeter\u003e for Centimeter {\n    fn into(self) -\u003e Meter {\n        Meter(self.0 / 100)\n    }\n}\npub fn main() {\n    let width = Meter(3);\n    let height = Centimeter(300);\n    let circumference: Meter = (Rectangle::create(\n        width,\n        height,\n    ))\n    .circumference();\n    assert_eq!(circumference, Meter(12));\n}\n```","date":"2021-08-30","ogImage":null,"coverImage":null,"author":{"__typename":"Author","name":"Nigel Schuster","slug":"nigel-schuster","picture":{"__typename":"Asset","url":"https://media.graphcms.com/resize=fit:crop,height:100,width:100/1bF1qLxsSbElgNK5x6t6"}}},"moreStories":[{"__typename":"Post","title":"Systemd Services are frustratingly hard to make safe","slug":"systemd-frustration","excerpt":"This article takes a dive into what it takes to set up a systemd service with the principle of least privilege.","coverImage":null,"author":{"__typename":"Author","name":"Nigel Schuster","slug":"nigel-schuster","picture":{"__typename":"Asset","url":"https://media.graphcms.com/resize=fit:crop,height:100,width:100/1bF1qLxsSbElgNK5x6t6"}}},{"__typename":"Post","title":"Variants are incredibly powerful","slug":"variants-are-powerful","excerpt":"Variants are an incredibly powerful tool to express the state of your program!","coverImage":null,"author":{"__typename":"Author","name":"Nigel Schuster","slug":"nigel-schuster","picture":{"__typename":"Asset","url":"https://media.graphcms.com/resize=fit:crop,height:100,width:100/1bF1qLxsSbElgNK5x6t6"}}}],"__typename":"Query"},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"avoid-generic-types"},"buildId":"xe9nAKT4rv0d4tn_7yU62","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>