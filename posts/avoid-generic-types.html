<!DOCTYPE html><html lang="en"><head><meta name="theme-color" content="#1976d2"/><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><script data-goatcounter-settings="{}" data-goatcounter="https://nigel.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script><title>Avoiding generic types for safer code</title><meta name="description" content=""/><meta property="og:title" content="Avoiding generic types for safer code"/><meta property="og:description" content=""/><meta property="og:type" content="article"/><meta property="og:locale" content="en_US"/><meta name="next-head-count" content="19"/><link rel="preload" href="/_next/static/css/5ea27e5c9dd48442fdad.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5ea27e5c9dd48442fdad.css" data-n-g=""/><link rel="preload" href="/_next/static/css/4e839cf21ff6bf076b3f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/4e839cf21ff6bf076b3f.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-5c5c9a38a56b2b88ab7c.js" defer=""></script><script src="/_next/static/chunks/framework-09a88f8e6a8ced89af74.js" defer=""></script><script src="/_next/static/chunks/main-3406814bfe8b50bda517.js" defer=""></script><script src="/_next/static/chunks/pages/_app-14a534532eb19b36de8c.js" defer=""></script><script src="/_next/static/chunks/799-20844999efc25938d359.js" defer=""></script><script src="/_next/static/chunks/316-9d3837eadcdc632b6aa2.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-2ae2dd2555268f39a2dd.js" defer=""></script><script src="/_next/static/nkfMGb3V3uDcQSancvdLI/_buildManifest.js" defer=""></script><script src="/_next/static/nkfMGb3V3uDcQSancvdLI/_ssgManifest.js" defer=""></script><style data-emotion="css-global o6gwfi">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><style data-emotion="css 1oqqzyl-MuiContainer-root 3ntvoq-MuiTypography-root-MuiLink-root bhp9pd-MuiPaper-root-MuiCard-root o69gx8-MuiCardMedia-root 46bh2p-MuiCardContent-root k008qs i9gxme gepadz-MuiTypography-root 56sg73 1iz24ed-MuiChip-root 1wlk0hk-MuiAvatar-root 1pqm26d-MuiAvatar-img 6od3lo-MuiChip-label 5lbw0b-MuiTypography-root 1ld3b9g-MuiGrid-root 1tp3ba8-MuiGrid-root b6lsxj-MuiButtonBase-root-MuiCardActionArea-root uxrmkj-MuiTypography-root-MuiLink-root ahj2mt-MuiTypography-root 1v2exvi-MuiCardActionArea-focusHighlight">.css-1oqqzyl-MuiContainer-root{width:100%;margin-left:auto;box-sizing:border-box;margin-right:auto;display:block;padding-left:16px;padding-right:16px;}@media (min-width:600px){.css-1oqqzyl-MuiContainer-root{padding-left:24px;padding-right:24px;}}@media (min-width:1200px){.css-1oqqzyl-MuiContainer-root{max-width:1200px;}}.css-3ntvoq-MuiTypography-root-MuiLink-root{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:300;font-size:6rem;line-height:1.167;letter-spacing:-0.01562em;color:inherit;-webkit-text-decoration:none;text-decoration:none;}.css-bhp9pd-MuiPaper-root-MuiCard-root{background-color:#fff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;border-radius:4px;box-shadow:0px 2px 1px -1px rgba(0,0,0,0.2),0px 1px 1px 0px rgba(0,0,0,0.14),0px 1px 3px 0px rgba(0,0,0,0.12);overflow:hidden;}.css-o69gx8-MuiCardMedia-root{display:block;-webkit-background-size:cover;background-size:cover;background-repeat:no-repeat;-webkit-background-position:center;background-position:center;width:100%;object-fit:cover;}.css-46bh2p-MuiCardContent-root{padding:16px;}.css-46bh2p-MuiCardContent-root:last-child{padding-bottom:24px;}.css-k008qs{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}.css-i9gxme{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}.css-gepadz-MuiTypography-root{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:3rem;line-height:1.167;letter-spacing:0em;}.css-56sg73{-webkit-align-self:flex-end;-ms-flex-item-align:flex-end;align-self:flex-end;}.css-1iz24ed-MuiChip-root{font-family:"Roboto","Helvetica","Arial",sans-serif;font-size:0.8125rem;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;height:32px;color:rgba(0, 0, 0, 0.87);background-color:rgba(0, 0, 0, 0.08);border-radius:16px;white-space:nowrap;-webkit-transition:background-color 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;cursor:default;outline:0;-webkit-text-decoration:none;text-decoration:none;border:0;padding:0;vertical-align:middle;box-sizing:border-box;}.css-1iz24ed-MuiChip-root.Mui-disabled{opacity:0.38;pointer-events:none;}.css-1iz24ed-MuiChip-root .MuiChip-avatar{margin-left:5px;margin-right:-6px;width:24px;height:24px;color:#616161;font-size:0.75rem;}.css-1iz24ed-MuiChip-root .MuiChip-avatarColorPrimary{color:#fff;background-color:#1565c0;}.css-1iz24ed-MuiChip-root .MuiChip-avatarColorSecondary{color:#fff;background-color:#7b1fa2;}.css-1iz24ed-MuiChip-root .MuiChip-avatarSmall{margin-left:4px;margin-right:-4px;width:18px;height:18px;font-size:0.625rem;}.css-1iz24ed-MuiChip-root .MuiChip-icon{color:#616161;margin-left:5px;margin-right:-6px;}.css-1iz24ed-MuiChip-root .MuiChip-deleteIcon{-webkit-tap-highlight-color:transparent;color:rgba(0, 0, 0, 0.26);font-size:22px;cursor:pointer;margin:0 5px 0 -6px;}.css-1iz24ed-MuiChip-root .MuiChip-deleteIcon:hover{color:rgba(0, 0, 0, 0.4);}.css-1wlk0hk-MuiAvatar-root{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:40px;height:40px;font-family:"Roboto","Helvetica","Arial",sans-serif;font-size:1.25rem;line-height:1;border-radius:50%;overflow:hidden;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}.css-1pqm26d-MuiAvatar-img{width:100%;height:100%;text-align:center;object-fit:cover;color:transparent;text-indent:10000px;}.css-6od3lo-MuiChip-label{overflow:hidden;text-overflow:ellipsis;padding-left:12px;padding-right:12px;white-space:nowrap;}.css-5lbw0b-MuiTypography-root{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:2.125rem;line-height:1.235;letter-spacing:0.00735em;}.css-1ld3b9g-MuiGrid-root{box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;width:100%;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;margin-top:-40px;width:calc(100% + 40px);margin-left:-40px;}.css-1ld3b9g-MuiGrid-root>.MuiGrid-item{padding-top:40px;}.css-1ld3b9g-MuiGrid-root>.MuiGrid-item{padding-left:40px;}.css-1tp3ba8-MuiGrid-root{box-sizing:border-box;margin:0;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-flex-basis:100%;-ms-flex-preferred-size:100%;flex-basis:100%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:100%;}@media (min-width:900px){.css-1tp3ba8-MuiGrid-root{-webkit-flex-basis:50%;-ms-flex-preferred-size:50%;flex-basis:50%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:50%;}}.css-b6lsxj-MuiButtonBase-root-MuiCardActionArea-root{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;display:block;text-align:inherit;width:100%;}.css-b6lsxj-MuiButtonBase-root-MuiCardActionArea-root::-moz-focus-inner{border-style:none;}.css-b6lsxj-MuiButtonBase-root-MuiCardActionArea-root.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-b6lsxj-MuiButtonBase-root-MuiCardActionArea-root{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-b6lsxj-MuiButtonBase-root-MuiCardActionArea-root:hover .MuiCardActionArea-focusHighlight{opacity:0.04;}@media (hover: none){.css-b6lsxj-MuiButtonBase-root-MuiCardActionArea-root:hover .MuiCardActionArea-focusHighlight{opacity:0;}}.css-b6lsxj-MuiButtonBase-root-MuiCardActionArea-root.Mui-focusVisible .MuiCardActionArea-focusHighlight{opacity:0.12;}.css-uxrmkj-MuiTypography-root-MuiLink-root{margin:0;color:inherit;-webkit-text-decoration:none;text-decoration:none;}.css-ahj2mt-MuiTypography-root{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;}.css-1v2exvi-MuiCardActionArea-focusHighlight{overflow:hidden;pointer-events:none;position:absolute;top:0;right:0;bottom:0;left:0;border-radius:inherit;opacity:0;background-color:currentcolor;-webkit-transition:opacity 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:opacity 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}</style></head><body><div id="__next"><div class="min-h-screen"><div class="border-b bg-accent-1 border-accent-2"><div class="MuiContainer-root MuiContainer-maxWidthLg css-1oqqzyl-MuiContainer-root"><div class="py-2 text-center text-sm"></div></div></div><main><div class="MuiContainer-root MuiContainer-maxWidthLg css-1oqqzyl-MuiContainer-root"><a class="MuiTypography-root MuiTypography-h1 MuiLink-root MuiLink-underlineNone css-3ntvoq-MuiTypography-root-MuiLink-root" href="/">Nigel&#x27;s Blog.</a><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation1 MuiCard-root css-bhp9pd-MuiPaper-root-MuiCard-root"><img class="MuiCardMedia-root MuiCardMedia-media MuiCardMedia-img css-o69gx8-MuiCardMedia-root"/><div class="MuiCardContent-root css-46bh2p-MuiCardContent-root"><div class="MuiBox-root css-k008qs"><div class="MuiBox-root css-i9gxme"><h1 class="MuiTypography-root MuiTypography-h3 css-gepadz-MuiTypography-root">Avoiding generic types for safer code</h1></div><div class="MuiBox-root css-56sg73"><div class="MuiChip-root MuiChip-filled MuiChip-sizeMedium MuiChip-colorDefault MuiChip-filledDefault css-1iz24ed-MuiChip-root"><div class="MuiAvatar-root MuiAvatar-circular MuiChip-avatar MuiChip-avatarMedium MuiChip-avatarColorDefault css-1wlk0hk-MuiAvatar-root"><img alt="Nigel Schuster" src="https://media.graphcms.com/resize=fit:crop,height:100,width:100/1bF1qLxsSbElgNK5x6t6" class="MuiAvatar-img css-1pqm26d-MuiAvatar-img"/></div><span class="MuiChip-label MuiChip-labelMedium css-6od3lo-MuiChip-label">Nigel Schuster</span></div></div></div><p>Generic types like <code>int</code> or <code>string</code> are quick and easy to use. However, sometimes they represent a specific concept. Declaring a new type is an easy way to avoid confusion. Let&#x27;s look at the following code:</p>
<pre><code class="hljs language-rust"><span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title hljs-function">rectangle_circumference</span>(width: <span class="hljs-type">u32</span>, height: <span class="hljs-type">u32</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">u32</span> {
    <span class="hljs-number">2</span> * width + <span class="hljs-number">2</span> * height
}
</code></pre>
<p>This code is meant to calculate the circumference of some arbitrary rectangle. It is simple and universally usable. However, it is very easy to use incorrectly. We have no guarantee that the units are all the same. <code>width</code> could be in centimeters, while <code>height</code> is in meters. To alleviate this problem, we can declare a specific type for a unit:</p>
<pre><code class="hljs language-rust"><span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title hljs-class">Meter</span>(<span class="hljs-keyword">pub</span> <span class="hljs-type">u32</span>);
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title hljs-function">rectangle_circumference</span>(width: Meter, height: Meter) <span class="hljs-punctuation">-&gt;</span> Meter {
    <span class="hljs-title hljs-function hljs-invoke">Meter</span>(<span class="hljs-number">2</span> * width.<span class="hljs-number">0</span> + <span class="hljs-number">2</span> * height.<span class="hljs-number">0</span>)
}
</code></pre>
<p>With this, we now put the burden on the caller to ensure that both inputs are of type <code>Meter</code>, and we guarantee that the output is of type <code>Meter</code> as well. At first sight, you may think that this incurs some overhead, however, the Godbolt output is the same for both versions when using <code>-C opt-level=3</code>:</p>
<pre><code class="hljs language-x86asm"><span class="hljs-symbol">example:</span>:rectangle_circumference:
        <span class="hljs-keyword">add</span>     <span class="hljs-built_in">edi</span>, <span class="hljs-built_in">esi</span>
        <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">eax</span>, [<span class="hljs-built_in">rdi</span> + <span class="hljs-built_in">rdi</span>]
        <span class="hljs-keyword">ret</span>
</code></pre>
<p>Of course, we should consider making this more generic while maintaining precise types:</p>
<pre><code class="hljs language-rust"><span class="hljs-keyword">pub</span> <span class="hljs-keyword">trait</span> <span class="hljs-title hljs-class">LengthUnit</span> {}

<span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title hljs-class">Rectangle</span>&lt;T: LengthUnit&gt; {
    width: T,
    height: T,
}

<span class="hljs-keyword">impl</span>&lt;T: LengthUnit&gt; Rectangle&lt;T&gt;
<span class="hljs-keyword">where</span>
    T: std::ops::Add&lt;Output = T&gt; + <span class="hljs-built_in">Copy</span>,
{
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title hljs-function">circumference</span>(<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> T {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"></span><span class="hljs-variable">Rectangle</span> { width, height } = <span class="hljs-keyword">self</span>;
        width + width + height + height
    }
}

<span class="hljs-meta">#[derive(Clone, Copy)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title hljs-class">Meter</span>(<span class="hljs-type">u32</span>);
<span class="hljs-keyword">impl</span> <span class="hljs-title hljs-class">LengthUnit</span> <span class="hljs-keyword">for</span> <span class="hljs-title hljs-class">Meter</span> {}
<span class="hljs-keyword">impl</span> <span class="hljs-title hljs-class">std</span>::ops::Add <span class="hljs-keyword">for</span> <span class="hljs-title hljs-class">Meter</span> {
    <span class="hljs-keyword">type</span> <span class="hljs-title hljs-class">Output</span> = Meter;
    <span class="hljs-keyword">fn</span> <span class="hljs-title hljs-function">add</span>(<span class="hljs-keyword">self</span>, rhs: <span class="hljs-keyword">Self</span>) <span class="hljs-punctuation">-&gt;</span> Meter {
        <span class="hljs-title hljs-function hljs-invoke">Meter</span>(<span class="hljs-keyword">self</span>.<span class="hljs-number">0</span> + rhs.<span class="hljs-number">0</span>)
    }
}
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title hljs-function">rectangle_circumference</span>&lt;T&gt;(width: T, height: T) <span class="hljs-punctuation">-&gt;</span> T
<span class="hljs-keyword">where</span>
    T: LengthUnit + <span class="hljs-built_in">Copy</span> + std::ops::Add&lt;Output = T&gt;,
{
    (Rectangle { width, height }).<span class="hljs-title hljs-function hljs-invoke">circumference</span>()
}
</code></pre>
<p>And even this code compiles down to the same assembly in Gobolt when calling it with <code>Meter(u32)</code> input.</p>
<h3>Bonus</h3>
<p>Rust makes it particularly easy for us to deal with different units. You can design a <code>create</code> function for the rectangle to account for different types:</p>
<pre><code class="hljs language-rust"><span class="hljs-keyword">impl</span>&lt;T: LengthUnit&gt; Rectangle&lt;T&gt; {
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title hljs-function">create</span>&lt;W, H&gt;(width: W, height: H) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span>
    <span class="hljs-keyword">where</span>
        W: std::convert::<span class="hljs-built_in">Into</span>&lt;T&gt;,
        H: std::convert::<span class="hljs-built_in">Into</span>&lt;T&gt;,
    {
        <span class="hljs-keyword">Self</span> {
            width: width.<span class="hljs-title hljs-function hljs-invoke">into</span>(),
            height: height.<span class="hljs-title hljs-function hljs-invoke">into</span>(),
        }
    }
}
</code></pre>
<p>This allows us to write the following program:</p>
<pre><code class="hljs language-rust"><span class="hljs-meta">#[derive(Clone, Copy, Eq, PartialEq, Debug)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title hljs-class">Meter</span>(<span class="hljs-type">u32</span>);
...
<span class="hljs-meta">#[derive(Clone, Copy)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title hljs-class">Centimeter</span>(<span class="hljs-type">u32</span>);
<span class="hljs-keyword">impl</span> <span class="hljs-title hljs-class">LengthUnit</span> <span class="hljs-keyword">for</span> <span class="hljs-title hljs-class">Centimeter</span> {}
<span class="hljs-keyword">impl</span> <span class="hljs-title hljs-class">std</span>::convert::<span class="hljs-built_in">Into</span>&lt;Meter&gt; <span class="hljs-keyword">for</span> <span class="hljs-title hljs-class">Centimeter</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title hljs-function">into</span>(<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> Meter {
        <span class="hljs-title hljs-function hljs-invoke">Meter</span>(<span class="hljs-keyword">self</span>.<span class="hljs-number">0</span> / <span class="hljs-number">100</span>)
    }
}
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title hljs-function">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"></span><span class="hljs-variable">width</span> = <span class="hljs-title hljs-function hljs-invoke">Meter</span>(<span class="hljs-number">3</span>);
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"></span><span class="hljs-variable">height</span> = <span class="hljs-title hljs-function hljs-invoke">Centimeter</span>(<span class="hljs-number">300</span>);
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"></span><span class="hljs-variable">circumference</span>: Meter = (Rectangle::<span class="hljs-title hljs-function hljs-invoke">create</span>(
        width,
        height,
    ))
    .<span class="hljs-title hljs-function hljs-invoke">circumference</span>();
    <span class="hljs-built_in">assert_eq!</span>(circumference, <span class="hljs-title hljs-function hljs-invoke">Meter</span>(<span class="hljs-number">12</span>));
}
</code></pre><div></div></div></div><hr class="border-accent-2 mt-28 mb-24"/><div><h4 class="MuiTypography-root MuiTypography-h4 css-5lbw0b-MuiTypography-root">More Stories</h4><div class="MuiGrid-root MuiGrid-container MuiGrid-spacing-xs-5 css-1ld3b9g-MuiGrid-root"><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-12 MuiGrid-grid-md-6 css-1tp3ba8-MuiGrid-root"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation1 MuiCard-root css-bhp9pd-MuiPaper-root-MuiCard-root"><img class="MuiCardMedia-root MuiCardMedia-media MuiCardMedia-img css-o69gx8-MuiCardMedia-root"/><div class="MuiCardContent-root css-46bh2p-MuiCardContent-root"><button class="MuiButtonBase-root MuiCardActionArea-root css-b6lsxj-MuiButtonBase-root-MuiCardActionArea-root" tabindex="0" type="button"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineNone css-uxrmkj-MuiTypography-root-MuiLink-root" href="/posts/how-to-csp"><div class="MuiBox-root css-k008qs"><div class="MuiBox-root css-i9gxme"><h4 class="MuiTypography-root MuiTypography-h4 css-5lbw0b-MuiTypography-root">How to CSP</h4></div><div class="MuiBox-root css-56sg73"><div class="MuiChip-root MuiChip-filled MuiChip-sizeMedium MuiChip-colorDefault MuiChip-filledDefault css-1iz24ed-MuiChip-root"><div class="MuiAvatar-root MuiAvatar-circular MuiChip-avatar MuiChip-avatarMedium MuiChip-avatarColorDefault css-1wlk0hk-MuiAvatar-root"><img alt="Nigel Schuster" src="https://media.graphcms.com/resize=fit:crop,height:100,width:100/1bF1qLxsSbElgNK5x6t6" class="MuiAvatar-img css-1pqm26d-MuiAvatar-img"/></div><span class="MuiChip-label MuiChip-labelMedium css-6od3lo-MuiChip-label">Nigel Schuster</span></div></div></div><p class="MuiTypography-root MuiTypography-body1 css-ahj2mt-MuiTypography-root">A good CSP can be a line of defence against XSS. It isn&#x27;t trivial to get it right though.</p></a><span class="MuiCardActionArea-focusHighlight css-1v2exvi-MuiCardActionArea-focusHighlight"></span></button></div></div></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-12 MuiGrid-grid-md-6 css-1tp3ba8-MuiGrid-root"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation1 MuiCard-root css-bhp9pd-MuiPaper-root-MuiCard-root"><img class="MuiCardMedia-root MuiCardMedia-media MuiCardMedia-img css-o69gx8-MuiCardMedia-root"/><div class="MuiCardContent-root css-46bh2p-MuiCardContent-root"><button class="MuiButtonBase-root MuiCardActionArea-root css-b6lsxj-MuiButtonBase-root-MuiCardActionArea-root" tabindex="0" type="button"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineNone css-uxrmkj-MuiTypography-root-MuiLink-root" href="/posts/object-destructuring"><div class="MuiBox-root css-k008qs"><div class="MuiBox-root css-i9gxme"><h4 class="MuiTypography-root MuiTypography-h4 css-5lbw0b-MuiTypography-root">Why object destructuring is awesome</h4></div><div class="MuiBox-root css-56sg73"><div class="MuiChip-root MuiChip-filled MuiChip-sizeMedium MuiChip-colorDefault MuiChip-filledDefault css-1iz24ed-MuiChip-root"><div class="MuiAvatar-root MuiAvatar-circular MuiChip-avatar MuiChip-avatarMedium MuiChip-avatarColorDefault css-1wlk0hk-MuiAvatar-root"><img alt="Nigel Schuster" src="https://media.graphcms.com/resize=fit:crop,height:100,width:100/1bF1qLxsSbElgNK5x6t6" class="MuiAvatar-img css-1pqm26d-MuiAvatar-img"/></div><span class="MuiChip-label MuiChip-labelMedium css-6od3lo-MuiChip-label">Nigel Schuster</span></div></div></div><p class="MuiTypography-root MuiTypography-body1 css-ahj2mt-MuiTypography-root">Object destructuring makes it easier to ensure you use all fields and avoids dead code.</p></a><span class="MuiCardActionArea-focusHighlight css-1v2exvi-MuiCardActionArea-focusHighlight"></span></button></div></div></div></div></div></div></main></div><footer class="bg-accent-1 border-t border-accent-2"><div class="MuiContainer-root MuiContainer-maxWidthLg css-1oqqzyl-MuiContainer-root"><div class="py-28 flex flex-col lg:flex-row items-center"><h3 class="text-4xl lg:text-5xl font-bold tracking-tighter leading-tight text-center lg:text-left mb-10 lg:mb-0 lg:pr-4 lg:w-1/2">Nigel Schuster&#x27;s blog.</h3></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"__typename":"Query","moreStories":[{"__typename":"Post","author":{"__typename":"Author","name":"Nigel Schuster","picture":{"__typename":"Asset","url":"https://media.graphcms.com/resize=fit:crop,height:100,width:100/1bF1qLxsSbElgNK5x6t6"}},"coverImage":null,"excerpt":"A good CSP can be a line of defence against XSS. It isn't trivial to get it right though.","slug":"how-to-csp","title":"How to CSP"},{"__typename":"Post","author":{"__typename":"Author","name":"Nigel Schuster","picture":{"__typename":"Asset","url":"https://media.graphcms.com/resize=fit:crop,height:100,width:100/1bF1qLxsSbElgNK5x6t6"}},"coverImage":null,"excerpt":"Object destructuring makes it easier to ensure you use all fields and avoids dead code.","slug":"object-destructuring","title":"Why object destructuring is awesome"}],"post":{"__typename":"Post","author":{"__typename":"Author","name":"Nigel Schuster","picture":{"__typename":"Asset","url":"https://media.graphcms.com/resize=fit:crop,height:100,width:100/1bF1qLxsSbElgNK5x6t6"}},"content":"Generic types like `int` or `string` are quick and easy to use. However, sometimes they represent a specific concept. Declaring a new type is an easy way to avoid confusion. Let's look at the following code:\n```rust\npub fn rectangle_circumference(width: u32, height: u32) -\u003e u32 {\n    2 * width + 2 * height\n}\n```\nThis code is meant to calculate the circumference of some arbitrary rectangle. It is simple and universally usable. However, it is very easy to use incorrectly. We have no guarantee that the units are all the same. `width` could be in centimeters, while `height` is in meters. To alleviate this problem, we can declare a specific type for a unit:\n```rust\npub struct Meter(pub u32);\npub fn rectangle_circumference(width: Meter, height: Meter) -\u003e Meter {\n    Meter(2 * width.0 + 2 * height.0)\n}\n```\nWith this, we now put the burden on the caller to ensure that both inputs are of type `Meter`, and we guarantee that the output is of type `Meter` as well. At first sight, you may think that this incurs some overhead, however, the Godbolt output is the same for both versions when using `-C opt-level=3`:\n```x86asm\nexample::rectangle_circumference:\n        add     edi, esi\n        lea     eax, [rdi + rdi]\n        ret\n```\n\nOf course, we should consider making this more generic while maintaining precise types:\n```rust\npub trait LengthUnit {}\n\npub struct Rectangle\u003cT: LengthUnit\u003e {\n    width: T,\n    height: T,\n}\n\nimpl\u003cT: LengthUnit\u003e Rectangle\u003cT\u003e\nwhere\n    T: std::ops::Add\u003cOutput = T\u003e + Copy,\n{\n    pub fn circumference(self) -\u003e T {\n        let Rectangle { width, height } = self;\n        width + width + height + height\n    }\n}\n\n#[derive(Clone, Copy)]\nstruct Meter(u32);\nimpl LengthUnit for Meter {}\nimpl std::ops::Add for Meter {\n    type Output = Meter;\n    fn add(self, rhs: Self) -\u003e Meter {\n        Meter(self.0 + rhs.0)\n    }\n}\npub fn rectangle_circumference\u003cT\u003e(width: T, height: T) -\u003e T\nwhere\n    T: LengthUnit + Copy + std::ops::Add\u003cOutput = T\u003e,\n{\n    (Rectangle { width, height }).circumference()\n}\n```\nAnd even this code compiles down to the same assembly in Gobolt when calling it with `Meter(u32)` input. \n\n### Bonus\nRust makes it particularly easy for us to deal with different units. You can design a `create` function for the rectangle to account for different types:\n```rust\nimpl\u003cT: LengthUnit\u003e Rectangle\u003cT\u003e {\n    pub fn create\u003cW, H\u003e(width: W, height: H) -\u003e Self\n    where\n        W: std::convert::Into\u003cT\u003e,\n        H: std::convert::Into\u003cT\u003e,\n    {\n        Self {\n            width: width.into(),\n            height: height.into(),\n        }\n    }\n}\n```\nThis allows us to write the following program:\n```rust\n#[derive(Clone, Copy, Eq, PartialEq, Debug)]\nstruct Meter(u32);\n...\n#[derive(Clone, Copy)]\nstruct Centimeter(u32);\nimpl LengthUnit for Centimeter {}\nimpl std::convert::Into\u003cMeter\u003e for Centimeter {\n    fn into(self) -\u003e Meter {\n        Meter(self.0 / 100)\n    }\n}\npub fn main() {\n    let width = Meter(3);\n    let height = Centimeter(300);\n    let circumference: Meter = (Rectangle::create(\n        width,\n        height,\n    ))\n    .circumference();\n    assert_eq!(circumference, Meter(12));\n}\n```","coverImage":null,"date":"2021-08-30","ogImage":null,"slug":"avoid-generic-types","title":"Avoiding generic types for safer code"}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"avoid-generic-types"},"buildId":"nkfMGb3V3uDcQSancvdLI","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>