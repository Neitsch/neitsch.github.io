<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta content="initial-scale=1, width=device-width" name="viewport"/><link href="https://www.nigel-schuster.de/posts/variants-are-powerful" rel="canonical"/><link href="/favicon/apple-touch-icon.png" sizes="180x180"/><link href="/favicon/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"/><link href="/favicon/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"/><link href="/favicon/site.webmanifest" rel="manifest"/><link color="#000000" href="/favicon/safari-pinned-tab.svg"/><link href="/favicon/favicon.ico" rel="icon"/><meta content="#000000" name="msapplication-TileColor"/><meta content="/favicon/browserconfig.xml" name="msapplication-config"/><meta content="#000" name="theme-color"/><link href="/feed.xml" rel="alternate" type="application/rss+xml"/><script async="" data-goatcounter="https://nigel.goatcounter.com/count" data-goatcounter-settings="{}" src="//gc.zgo.at/count.js"></script><title>Variants are incredibly powerful</title><meta content="" name="description"/><meta content="Variants are incredibly powerful" property="og:title"/><meta content="" property="og:description"/><meta content="article" property="og:type"/><meta content="en_US" property="og:locale"/><meta name="next-head-count" content="20"/><meta content="#1976d2" name="theme-color"/><link rel="preload" href="/_next/static/css/727973242bb33abd.css" as="style"/><link rel="stylesheet" href="/_next/static/css/727973242bb33abd.css" data-n-g=""/><link rel="preload" href="/_next/static/css/2aec7fdc1f1ca4ae.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2aec7fdc1f1ca4ae.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-7a31c9011b982f4e.js" defer=""></script><script src="/_next/static/chunks/framework-b2e4119a90b05e32.js" defer=""></script><script src="/_next/static/chunks/main-8023383319e187c7.js" defer=""></script><script src="/_next/static/chunks/pages/_app-cf6ee6cdb257eaca.js" defer=""></script><script src="/_next/static/chunks/716-edf57120a84ba103.js" defer=""></script><script src="/_next/static/chunks/756-3e474c157f7881a6.js" defer=""></script><script src="/_next/static/chunks/782-50ee22c310ebd2e4.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-bb593f843b27bd4a.js" defer=""></script><script src="/_next/static/FUc6KbB8ckVeA8vmTe0Az/_buildManifest.js" defer=""></script><script src="/_next/static/FUc6KbB8ckVeA8vmTe0Az/_ssgManifest.js" defer=""></script><script src="/_next/static/FUc6KbB8ckVeA8vmTe0Az/_middlewareManifest.js" defer=""></script><style data-emotion="css-global o6gwfi">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><style data-emotion="css 1qsxih2 wpxufe s18byi rhsghg 1qw96cp k008qs i9gxme lq9rk4 56sg73 genwvd 3i9vrz 1hy9t21 9iedg7 1bw4yx3 1f04t6y g8y262 1jluznr 1qeofn3 9l3uo3 jo3ec3 19t329g">.css-1qsxih2{width:100%;margin-left:auto;box-sizing:border-box;margin-right:auto;display:block;padding-left:16px;padding-right:16px;}@media (min-width:600px){.css-1qsxih2{padding-left:24px;padding-right:24px;}}@media (min-width:1200px){.css-1qsxih2{max-width:1200px;}}.css-wpxufe{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:300;font-size:3.5rem;line-height:1.167;letter-spacing:-0.01562em;color:inherit;-webkit-text-decoration:none;text-decoration:none;}@media (min-width:600px){.css-wpxufe{font-size:4.7129rem;}}@media (min-width:900px){.css-wpxufe{font-size:5.3556rem;}}@media (min-width:1200px){.css-wpxufe{font-size:5.9983rem;}}.css-s18byi{background-color:#fff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;border-radius:4px;box-shadow:0px 2px 1px -1px rgba(0,0,0,0.2),0px 1px 1px 0px rgba(0,0,0,0.14),0px 1px 3px 0px rgba(0,0,0,0.12);overflow:hidden;}.css-rhsghg{display:block;-webkit-background-size:cover;background-size:cover;background-repeat:no-repeat;-webkit-background-position:center;background-position:center;width:100%;object-fit:cover;}.css-1qw96cp{padding:16px;}.css-1qw96cp:last-child{padding-bottom:24px;}.css-k008qs{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}.css-i9gxme{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}.css-lq9rk4{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:2rem;line-height:1.167;letter-spacing:0em;}@media (min-width:600px){.css-lq9rk4{font-size:2.5707rem;}}@media (min-width:900px){.css-lq9rk4{font-size:2.7849rem;}}@media (min-width:1200px){.css-lq9rk4{font-size:2.9991rem;}}.css-56sg73{-webkit-align-self:flex-end;-ms-flex-item-align:flex-end;align-self:flex-end;}.css-genwvd{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;max-width:100%;font-family:"Roboto","Helvetica","Arial",sans-serif;font-size:0.8125rem;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;height:32px;color:rgba(0, 0, 0, 0.87);background-color:rgba(0, 0, 0, 0.08);border-radius:16px;white-space:nowrap;-webkit-transition:background-color 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;cursor:default;outline:0;-webkit-text-decoration:none;text-decoration:none;border:0;padding:0;vertical-align:middle;box-sizing:border-box;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent;cursor:pointer;}.css-genwvd::-moz-focus-inner{border-style:none;}.css-genwvd.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-genwvd{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-genwvd.Mui-disabled{opacity:0.38;pointer-events:none;}.css-genwvd .MuiChip-avatar{margin-left:5px;margin-right:-6px;width:24px;height:24px;color:#616161;font-size:0.75rem;}.css-genwvd .MuiChip-avatarColorPrimary{color:#fff;background-color:#1565c0;}.css-genwvd .MuiChip-avatarColorSecondary{color:#fff;background-color:#7b1fa2;}.css-genwvd .MuiChip-avatarSmall{margin-left:4px;margin-right:-4px;width:18px;height:18px;font-size:0.625rem;}.css-genwvd .MuiChip-icon{color:#616161;margin-left:5px;margin-right:-6px;}.css-genwvd .MuiChip-deleteIcon{-webkit-tap-highlight-color:transparent;color:rgba(0, 0, 0, 0.26);font-size:22px;cursor:pointer;margin:0 5px 0 -6px;}.css-genwvd .MuiChip-deleteIcon:hover{color:rgba(0, 0, 0, 0.4);}.css-genwvd:hover{background-color:rgba(0, 0, 0, 0.12);}.css-genwvd.Mui-focusVisible{background-color:rgba(0, 0, 0, 0.2);}.css-genwvd:active{box-shadow:0px 2px 1px -1px rgba(0,0,0,0.2),0px 1px 1px 0px rgba(0,0,0,0.14),0px 1px 3px 0px rgba(0,0,0,0.12);}.css-3i9vrz{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:40px;height:40px;font-family:"Roboto","Helvetica","Arial",sans-serif;font-size:1.25rem;line-height:1;border-radius:50%;overflow:hidden;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}.css-1hy9t21{width:100%;height:100%;text-align:center;object-fit:cover;color:transparent;text-indent:10000px;}.css-9iedg7{overflow:hidden;text-overflow:ellipsis;padding-left:12px;padding-right:12px;white-space:nowrap;}.css-1bw4yx3{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;font-style:italic;padding-bottom:1.5em;}.css-1f04t6y{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1.5625rem;line-height:1.235;letter-spacing:0.00735em;}@media (min-width:600px){.css-1f04t6y{font-size:1.8219rem;}}@media (min-width:900px){.css-1f04t6y{font-size:2.0243rem;}}@media (min-width:1200px){.css-1f04t6y{font-size:2.0243rem;}}.css-g8y262{width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-flow:column wrap;-webkit-flex-flow:column wrap;-ms-flex-flow:column wrap;flex-flow:column wrap;-webkit-align-content:space-between;-ms-flex-line-pack:space-between;align-content:space-between;box-sizing:border-box;}.css-g8y262>*{box-sizing:border-box;}@media (min-width:0px){.css-g8y262{margin:-4px;}.css-g8y262>*{margin:4px;width:calc(100.00% - 8px);}}@media (min-width:600px){.css-g8y262{margin:-4px;}.css-g8y262>*{margin:4px;width:calc(50.00% - 8px);}}@media (min-width:900px){.css-g8y262{margin:-8px;}.css-g8y262>*{margin:8px;width:calc(50.00% - 16px);}}.css-1jluznr{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;display:block;text-align:inherit;width:100%;}.css-1jluznr::-moz-focus-inner{border-style:none;}.css-1jluznr.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-1jluznr{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-1jluznr:hover .MuiCardActionArea-focusHighlight{opacity:0.04;}@media (hover: none){.css-1jluznr:hover .MuiCardActionArea-focusHighlight{opacity:0;}}.css-1jluznr.Mui-focusVisible .MuiCardActionArea-focusHighlight{opacity:0.12;}.css-1qeofn3{margin:0;color:inherit;-webkit-text-decoration:none;text-decoration:none;}.css-9l3uo3{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;}.css-jo3ec3{overflow:hidden;pointer-events:none;position:absolute;top:0;right:0;bottom:0;left:0;border-radius:inherit;opacity:0;background-color:currentcolor;-webkit-transition:opacity 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:opacity 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.css-19t329g{margin:0;color:inherit;-webkit-text-decoration:underline;text-decoration:underline;}.css-19t329g:hover{text-decoration-color:inherit;}</style></head><body><div id="__next" data-reactroot=""><div class="min-h-screen"><main><div class="MuiContainer-root MuiContainer-maxWidthLg css-1qsxih2"><a class="MuiTypography-root MuiTypography-h1 MuiLink-root MuiLink-underlineNone css-wpxufe" href="/">Yet another SWE Blog.</a><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation1 MuiCard-root css-s18byi"><img class="MuiCardMedia-root MuiCardMedia-media MuiCardMedia-img css-rhsghg"/><div class="MuiCardContent-root css-1qw96cp"><div class="MuiBox-root css-k008qs"><div class="MuiBox-root css-i9gxme"><h1 class="MuiTypography-root MuiTypography-h3 css-lq9rk4">Variants are incredibly powerful</h1></div><div class="MuiBox-root css-56sg73"><div class="MuiButtonBase-root MuiChip-root MuiChip-filled MuiChip-sizeMedium MuiChip-colorDefault MuiChip-clickable MuiChip-clickableColorDefault MuiChip-filledDefault css-genwvd" tabindex="0" href="/author/nigel-schuster"><div class="MuiAvatar-root MuiAvatar-circular MuiChip-avatar MuiChip-avatarMedium MuiChip-avatarColorDefault css-3i9vrz"><img alt="Nigel Schuster" src="https://media.graphassets.com/resize=fit:crop,height:100,width:100/1bF1qLxsSbElgNK5x6t6" class="MuiAvatar-img css-1hy9t21"/></div><span class="MuiChip-label MuiChip-labelMedium css-9iedg7">Nigel Schuster</span></div></div></div><p>Variants allow you to express that a value may be in more than one distinct states. Over the last years I have grown more fond of leveraging variants throughout my code to express the state that my program is in. Most programming languages support some form of variants, but are sometimes not given the time of day. For me personally, I often caught myself neglecting the usage of variants due to the verbosity of introducing additional types.</p>
<p>A trivial example to start with is that we want to calculate the surface area of a geometric shape. In Typescript with an interface we could write something along the lines of:</p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title hljs-class">GeometricShape</span> {
  <span class="hljs-title hljs-function">getSurfaceArea</span>(): <span class="hljs-built_in">number</span>;
}
<span class="hljs-keyword">class</span> <span class="hljs-title hljs-class">Square</span> <span class="hljs-keyword">implements</span> <span class="hljs-title hljs-class">GeometricShape</span> {
  <span class="hljs-attr">length</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-title hljs-function">constructor</span>(<span class="hljs-params">length: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-variable hljs-language">this</span>.<span class="hljs-property">length</span> = length;
  }
  <span class="hljs-title hljs-function">getSurfaceArea</span>(): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable hljs-language">this</span>.<span class="hljs-property">length</span> * <span class="hljs-variable hljs-language">this</span>.<span class="hljs-property">length</span>;
  }
}
<span class="hljs-keyword">class</span> <span class="hljs-title hljs-class">RightTriangle</span> <span class="hljs-keyword">implements</span> <span class="hljs-title hljs-class">GeometricShape</span> {
  <span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-title hljs-function">constructor</span>(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-variable hljs-language">this</span>.<span class="hljs-property">a</span> = a;
    <span class="hljs-variable hljs-language">this</span>.<span class="hljs-property">b</span> = b;
  }
  <span class="hljs-title hljs-function">getSurfaceArea</span>(): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">return</span> (<span class="hljs-variable hljs-language">this</span>.<span class="hljs-property">a</span> * <span class="hljs-variable hljs-language">this</span>.<span class="hljs-property">b</span>) / <span class="hljs-number">2</span>;
  }
}
</code></pre>
<p>However, Typescript also supports polymorphism via variants as <a href="https://www.typescriptlang.org/docs/handbook/2/narrowing.html#discriminated-unions">discriminated unions</a>:</p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">type</span> square = {
  <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;square&quot;</span>;
  <span class="hljs-attr">length</span>: <span class="hljs-built_in">number</span>;
};
<span class="hljs-keyword">type</span> rightTriangle = {
  <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;rightTriangle&quot;</span>;
  <span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span>;
};
<span class="hljs-keyword">type</span> geometricShape = square | rightTriangle;
<span class="hljs-keyword">function</span> <span class="hljs-title hljs-function">surfaceArea</span>(<span class="hljs-params">shape: geometricShape</span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">switch</span> (shape.<span class="hljs-property">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;square&quot;</span>:
      <span class="hljs-keyword">return</span> shape.<span class="hljs-property">length</span> * shape.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;rightTriangle&quot;</span>:
      <span class="hljs-keyword">return</span> (shape.<span class="hljs-property">a</span> * shape.<span class="hljs-property">b</span>) / <span class="hljs-number">2</span>;
  }
}
</code></pre>
<p>If you take a second to think about the two ways to implement a function to compute the surface area, you will realize that users may interact very differently with the two APIs. In fact, I would consider the interface solution more powerful in this example: The user of the API is able to add more shapes, as long as it implements <code>GeometricShape</code>. However, the challenge lies in designing a good API that can be implemented by all classes.</p>
<p>To continue our example, let&#x27;s consider that we added a new function <code>getAnglesOfShape(): Array&lt;number&gt;</code> that returns the angles of the shape. We can then use it to validate that the inner angles add up to 360.</p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title hljs-class">GeometricShape</span> {
  <span class="hljs-title hljs-function">getInteriorAngles</span>(): <span class="hljs-title hljs-class">Array</span>&lt;<span class="hljs-built_in">number</span>&gt;;
}
<span class="hljs-keyword">function</span> <span class="hljs-title hljs-function">validateShape</span>(<span class="hljs-params">shape: GeometricShape</span>) {
  <span class="hljs-keyword">const</span> angles = shape.<span class="hljs-title hljs-function">getInteriorAngles</span>();
  <span class="hljs-keyword">let</span> exteriorAngleSum = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> angle <span class="hljs-keyword">of</span> angles) {
    exteriorAngleSum += <span class="hljs-number">180</span> - angle;
  }
  <span class="hljs-keyword">return</span> exteriorAngleSum == <span class="hljs-number">360</span>;
}
</code></pre>
<p>Unfortunately, now a user attempted to implement a <code>Circle</code>, but struggles to implement <code>getAnglesOfShape</code>. It seemed like a perfectly reasonable method to add at the time, but now we found a shape that has infinitely many angles (or none?) and can&#x27;t return a sensible result that can pass our validation. While a variant by itself can&#x27;t save us, it simplifies our validationCode:</p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">function</span> <span class="hljs-title hljs-function">getInteriorAngles</span>(<span class="hljs-params">shape: square | rightTriangle</span>): <span class="hljs-title hljs-class">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; {
  <span class="hljs-keyword">switch</span> (shape.<span class="hljs-property">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;square&quot;</span>:
      <span class="hljs-keyword">return</span> [<span class="hljs-number">90</span>, <span class="hljs-number">90</span>, <span class="hljs-number">90</span>, <span class="hljs-number">90</span>];
    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;rightTriangle&quot;</span>:
      <span class="hljs-keyword">const</span> alpha = <span class="hljs-title hljs-class">Math</span>.<span class="hljs-title hljs-function">atan</span>(shape.<span class="hljs-property">a</span> / shape.<span class="hljs-property">b</span>);
      <span class="hljs-keyword">return</span> [alpha, <span class="hljs-number">90</span> - alpha, <span class="hljs-number">90</span>];
  }
}
<span class="hljs-keyword">function</span> <span class="hljs-title hljs-function">validateShape</span>(<span class="hljs-params">shape: geometricShape</span>) {
  <span class="hljs-keyword">switch</span> (shape.<span class="hljs-property">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;circle&quot;</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">const</span> angles = <span class="hljs-title hljs-function">getInteriorAngles</span>(shape);
      <span class="hljs-keyword">let</span> exteriorAngleSum = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> angle <span class="hljs-keyword">of</span> angles) {
        exteriorAngleSum += <span class="hljs-number">180</span> - angle;
      }
      <span class="hljs-keyword">return</span> exteriorAngleSum == <span class="hljs-number">360</span>;
  }
}
</code></pre>
<p>While we partially simply profit from restricting the user from implementing types, we can also note that we pushed the responsibility of handling the new shape to the consumer.</p>
<p>I hope this gave you a little taste of why variants may be useful. One place where variants really start to shine is when writing finite state machines. For example, let&#x27;s try to model a connection that automatically reconnects if it got disconnected. It&#x27;s easy to express with a variant:</p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title hljs-class">Request</span> {}
<span class="hljs-keyword">interface</span> <span class="hljs-title hljs-class">Respoonse</span> {}
<span class="hljs-keyword">interface</span> <span class="hljs-title hljs-class">Connection</span> {
  <span class="hljs-title hljs-function">sendRequest</span>(<span class="hljs-attr">request</span>: <span class="hljs-title hljs-class">Request</span>):
    | {
        <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;sent&quot;</span>;
        <span class="hljs-attr">result</span>: <span class="hljs-title hljs-class">Promise</span>&lt;<span class="hljs-title hljs-class">Response</span>&gt;;
      }
    | { <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;notSent&quot;</span> };
}
<span class="hljs-keyword">interface</span> <span class="hljs-title hljs-class">ConnectionManager</span> {
  <span class="hljs-title hljs-function">makeConnection</span>(): <span class="hljs-title hljs-class">Promise</span>&lt;<span class="hljs-title hljs-class">Connection</span>&gt;;
}
<span class="hljs-keyword">type</span> connectionStatus =
  | {
      <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;disconnected&quot;</span>;
    }
  | {
      <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;reconnecting&quot;</span>;
      <span class="hljs-attr">pending</span>: <span class="hljs-title hljs-class">Promise</span>&lt;<span class="hljs-title hljs-class">Connection</span>&gt;;
    }
  | {
      <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;connected&quot;</span>;
      <span class="hljs-attr">connection</span>: <span class="hljs-title hljs-class">Connection</span>;
    };
<span class="hljs-keyword">class</span> <span class="hljs-title hljs-class">RetryingConnection</span> {
  <span class="hljs-attr">currentConnection</span>: connectionStatus;
  <span class="hljs-attr">manager</span>: <span class="hljs-title hljs-class">ConnectionManager</span>;
  <span class="hljs-title hljs-function">constructor</span>(<span class="hljs-params">manager: ConnectionManager</span>) {
    <span class="hljs-variable hljs-language">this</span>.<span class="hljs-property">manager</span> = manager;
    <span class="hljs-variable hljs-language">this</span>.<span class="hljs-property">currentConnection</span> = {
      <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;disconnected&quot;</span>,
    };
  }
  <span class="hljs-keyword">async</span> <span class="hljs-title hljs-function">sendRequest</span>(<span class="hljs-attr">request</span>: <span class="hljs-title hljs-class">Request</span>): <span class="hljs-title hljs-class">Promise</span>&lt;<span class="hljs-title hljs-class">Response</span>&gt; {
    <span class="hljs-keyword">let</span> sentRequest;
    <span class="hljs-keyword">do</span> {
      <span class="hljs-keyword">switch</span> (<span class="hljs-variable hljs-language">this</span>.<span class="hljs-property">currentConnection</span>.<span class="hljs-property">status</span>) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;connected&quot;</span>:
          sentRequest = <span class="hljs-variable hljs-language">this</span>.<span class="hljs-property">currentConnection</span>.<span class="hljs-property">connection</span>.<span class="hljs-title hljs-function">sendRequest</span>(request);
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;disconnected&quot;</span>:
          <span class="hljs-keyword">const</span> pendingConnection = <span class="hljs-variable hljs-language">this</span>.<span class="hljs-property">manager</span>.<span class="hljs-title hljs-function">makeConnection</span>();
          <span class="hljs-variable hljs-language">this</span>.<span class="hljs-property">currentConnection</span> = {
            <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;reconnecting&quot;</span>,
            <span class="hljs-attr">pending</span>: pendingConnection,
          };
        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;reconnecting&quot;</span>:
          sentRequest = <span class="hljs-keyword">await</span> <span class="hljs-variable hljs-language">this</span>.<span class="hljs-property">currentConnection</span>.<span class="hljs-property">pending</span>.<span class="hljs-title hljs-function">then</span>(
            <span class="hljs-function">(<span class="hljs-params">connection</span>) =&gt;</span> connection.<span class="hljs-title hljs-function">sendRequest</span>(request)
          );
      }
      <span class="hljs-keyword">if</span> (sentRequest.<span class="hljs-property">status</span> == <span class="hljs-string">&quot;notSent&quot;</span>) {
        <span class="hljs-variable hljs-language">this</span>.<span class="hljs-property">currentConnection</span> = {
          <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;disconnected&quot;</span>,
        };
      }
    } <span class="hljs-keyword">while</span> (sentRequest.<span class="hljs-property">status</span> == <span class="hljs-string">&quot;notSent&quot;</span>);
    <span class="hljs-keyword">return</span> sentRequest.<span class="hljs-property">result</span>;
  }
}
</code></pre>
<p>Modeling the transitions between &quot;disconnected&quot;, &quot;reconnecting&quot;, and &quot;connected&quot; is simply not possible without variants.</p><p class="MuiTypography-root MuiTypography-body1 css-1bw4yx3">Published on <!-- -->2021-11-24<!-- -->.</p></div></div><hr class="border-accent-2 mt-28 mb-24"/><div><h4 class="MuiTypography-root MuiTypography-h4 css-1f04t6y">More Stories</h4><div class="MuiMasonry-root css-g8y262"><div><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation1 MuiCard-root css-s18byi"><img class="MuiCardMedia-root MuiCardMedia-media MuiCardMedia-img css-rhsghg"/><div class="MuiCardContent-root css-1qw96cp"><button class="MuiButtonBase-root MuiCardActionArea-root css-1jluznr" tabindex="0" type="button"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineNone css-1qeofn3" href="/posts/systemd-frustration"><div class="MuiBox-root css-k008qs"><div class="MuiBox-root css-i9gxme"><h4 class="MuiTypography-root MuiTypography-h4 css-1f04t6y">Systemd Services are frustratingly hard to make safe</h4></div><div class="MuiBox-root css-56sg73"><div class="MuiButtonBase-root MuiChip-root MuiChip-filled MuiChip-sizeMedium MuiChip-colorDefault MuiChip-clickable MuiChip-clickableColorDefault MuiChip-filledDefault css-genwvd" tabindex="0" href="/author/nigel-schuster"><div class="MuiAvatar-root MuiAvatar-circular MuiChip-avatar MuiChip-avatarMedium MuiChip-avatarColorDefault css-3i9vrz"><img alt="Nigel Schuster" src="https://media.graphassets.com/resize=fit:crop,height:100,width:100/1bF1qLxsSbElgNK5x6t6" class="MuiAvatar-img css-1hy9t21"/></div><span class="MuiChip-label MuiChip-labelMedium css-9iedg7">Nigel Schuster</span></div></div></div><p class="MuiTypography-root MuiTypography-body1 css-9l3uo3">This article takes a dive into what it takes to set up a systemd service with the principle of least privilege.</p></a><span class="MuiCardActionArea-focusHighlight css-jo3ec3"></span></button></div></div></div><div><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation1 MuiCard-root css-s18byi"><img class="MuiCardMedia-root MuiCardMedia-media MuiCardMedia-img css-rhsghg"/><div class="MuiCardContent-root css-1qw96cp"><button class="MuiButtonBase-root MuiCardActionArea-root css-1jluznr" tabindex="0" type="button"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineNone css-1qeofn3" href="/posts/avoid-generic-types"><div class="MuiBox-root css-k008qs"><div class="MuiBox-root css-i9gxme"><h4 class="MuiTypography-root MuiTypography-h4 css-1f04t6y">Avoiding generic types for safer code</h4></div><div class="MuiBox-root css-56sg73"><div class="MuiButtonBase-root MuiChip-root MuiChip-filled MuiChip-sizeMedium MuiChip-colorDefault MuiChip-clickable MuiChip-clickableColorDefault MuiChip-filledDefault css-genwvd" tabindex="0" href="/author/nigel-schuster"><div class="MuiAvatar-root MuiAvatar-circular MuiChip-avatar MuiChip-avatarMedium MuiChip-avatarColorDefault css-3i9vrz"><img alt="Nigel Schuster" src="https://media.graphassets.com/resize=fit:crop,height:100,width:100/1bF1qLxsSbElgNK5x6t6" class="MuiAvatar-img css-1hy9t21"/></div><span class="MuiChip-label MuiChip-labelMedium css-9iedg7">Nigel Schuster</span></div></div></div><p class="MuiTypography-root MuiTypography-body1 css-9l3uo3">Using generic types like strings made me make mistakes on several occasion. There is a better way.</p></a><span class="MuiCardActionArea-focusHighlight css-jo3ec3"></span></button></div></div></div></div></div></div></main></div><footer><div class="MuiContainer-root MuiContainer-maxWidthLg css-1qsxih2"><p class="MuiTypography-root MuiTypography-body1 css-9l3uo3">Built with NextJS. Find the source <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-19t329g" href="https://github.com/Neitsch/neitsch.github.io">here</a>.</p></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"__typename":"Post","title":"Variants are incredibly powerful","slug":"variants-are-powerful","content":"Variants allow you to express that a value may be in more than one distinct states. Over the last years I have grown more fond of leveraging variants throughout my code to express the state that my program is in. Most programming languages support some form of variants, but are sometimes not given the time of day. For me personally, I often caught myself neglecting the usage of variants due to the verbosity of introducing additional types.\n\nA trivial example to start with is that we want to calculate the surface area of a geometric shape. In Typescript with an interface we could write something along the lines of:\n```typescript\ninterface GeometricShape {\n  getSurfaceArea(): number;\n}\nclass Square implements GeometricShape {\n  length: number;\n  constructor(length: number) {\n    this.length = length;\n  }\n  getSurfaceArea(): number {\n    return this.length * this.length;\n  }\n}\nclass RightTriangle implements GeometricShape {\n  a: number;\n  b: number;\n  constructor(a: number, b: number) {\n    this.a = a;\n    this.b = b;\n  }\n  getSurfaceArea(): number {\n    return (this.a * this.b) / 2;\n  }\n}\n```\nHowever, Typescript also supports polymorphism via variants as [discriminated unions](https://www.typescriptlang.org/docs/handbook/2/narrowing.html#discriminated-unions):\n```typescript\ntype square = {\n  type: \"square\";\n  length: number;\n};\ntype rightTriangle = {\n  type: \"rightTriangle\";\n  a: number;\n  b: number;\n};\ntype geometricShape = square | rightTriangle;\nfunction surfaceArea(shape: geometricShape): number {\n  switch (shape.type) {\n    case \"square\":\n      return shape.length * shape.length;\n    case \"rightTriangle\":\n      return (shape.a * shape.b) / 2;\n  }\n}\n```\nIf you take a second to think about the two ways to implement a function to compute the surface area, you will realize that users may interact very differently with the two APIs. In fact, I would consider the interface solution more powerful in this example: The user of the API is able to add more shapes, as long as it implements `GeometricShape`. However, the challenge lies in designing a good API that can be implemented by all classes.\n\nTo continue our example, let's consider that we added a new function `getAnglesOfShape(): Array\u003cnumber\u003e` that returns the angles of the shape. We can then use it to validate that the inner angles add up to 360.\n```typescript\ninterface GeometricShape {\n  getInteriorAngles(): Array\u003cnumber\u003e;\n}\nfunction validateShape(shape: GeometricShape) {\n  const angles = shape.getInteriorAngles();\n  let exteriorAngleSum = 0;\n  for (var angle of angles) {\n    exteriorAngleSum += 180 - angle;\n  }\n  return exteriorAngleSum == 360;\n}\n```\nUnfortunately, now a user attempted to implement a `Circle`, but struggles to implement `getAnglesOfShape`. It seemed like a perfectly reasonable method to add at the time, but now we found a shape that has infinitely many angles (or none?) and can't return a sensible result that can pass our validation. While a variant by itself can't save us, it simplifies our validationCode:\n```typescript\nfunction getInteriorAngles(shape: square | rightTriangle): Array\u003cnumber\u003e {\n  switch (shape.type) {\n    case \"square\":\n      return [90, 90, 90, 90];\n    case \"rightTriangle\":\n      const alpha = Math.atan(shape.a / shape.b);\n      return [alpha, 90 - alpha, 90];\n  }\n}\nfunction validateShape(shape: geometricShape) {\n  switch (shape.type) {\n    case \"circle\":\n      return true;\n    default:\n      const angles = getInteriorAngles(shape);\n      let exteriorAngleSum = 0;\n      for (var angle of angles) {\n        exteriorAngleSum += 180 - angle;\n      }\n      return exteriorAngleSum == 360;\n  }\n}\n```\nWhile we partially simply profit from restricting the user from implementing types, we can also note that we pushed the responsibility of handling the new shape to the consumer.\n\nI hope this gave you a little taste of why variants may be useful. One place where variants really start to shine is when writing finite state machines. For example, let's try to model a connection that automatically reconnects if it got disconnected. It's easy to express with a variant:\n```typescript\ninterface Request {}\ninterface Respoonse {}\ninterface Connection {\n  sendRequest(request: Request):\n    | {\n        status: \"sent\";\n        result: Promise\u003cResponse\u003e;\n      }\n    | { status: \"notSent\" };\n}\ninterface ConnectionManager {\n  makeConnection(): Promise\u003cConnection\u003e;\n}\ntype connectionStatus =\n  | {\n      status: \"disconnected\";\n    }\n  | {\n      status: \"reconnecting\";\n      pending: Promise\u003cConnection\u003e;\n    }\n  | {\n      status: \"connected\";\n      connection: Connection;\n    };\nclass RetryingConnection {\n  currentConnection: connectionStatus;\n  manager: ConnectionManager;\n  constructor(manager: ConnectionManager) {\n    this.manager = manager;\n    this.currentConnection = {\n      status: \"disconnected\",\n    };\n  }\n  async sendRequest(request: Request): Promise\u003cResponse\u003e {\n    let sentRequest;\n    do {\n      switch (this.currentConnection.status) {\n        case \"connected\":\n          sentRequest = this.currentConnection.connection.sendRequest(request);\n          break;\n        case \"disconnected\":\n          const pendingConnection = this.manager.makeConnection();\n          this.currentConnection = {\n            status: \"reconnecting\",\n            pending: pendingConnection,\n          };\n        case \"reconnecting\":\n          sentRequest = await this.currentConnection.pending.then(\n            (connection) =\u003e connection.sendRequest(request)\n          );\n      }\n      if (sentRequest.status == \"notSent\") {\n        this.currentConnection = {\n          status: \"disconnected\",\n        };\n      }\n    } while (sentRequest.status == \"notSent\");\n    return sentRequest.result;\n  }\n}\n```\nModeling the transitions between \"disconnected\", \"reconnecting\", and \"connected\" is simply not possible without variants.","date":"2021-11-24","ogImage":null,"coverImage":null,"author":{"__typename":"Author","name":"Nigel Schuster","slug":"nigel-schuster","picture":{"__typename":"Asset","url":"https://media.graphassets.com/resize=fit:crop,height:100,width:100/1bF1qLxsSbElgNK5x6t6"}}},"moreStories":[{"__typename":"Post","title":"Systemd Services are frustratingly hard to make safe","slug":"systemd-frustration","excerpt":"This article takes a dive into what it takes to set up a systemd service with the principle of least privilege.","coverImage":null,"author":{"__typename":"Author","name":"Nigel Schuster","slug":"nigel-schuster","picture":{"__typename":"Asset","url":"https://media.graphassets.com/resize=fit:crop,height:100,width:100/1bF1qLxsSbElgNK5x6t6"}}},{"__typename":"Post","title":"Avoiding generic types for safer code","slug":"avoid-generic-types","excerpt":"Using generic types like strings made me make mistakes on several occasion. There is a better way.","coverImage":null,"author":{"__typename":"Author","name":"Nigel Schuster","slug":"nigel-schuster","picture":{"__typename":"Asset","url":"https://media.graphassets.com/resize=fit:crop,height:100,width:100/1bF1qLxsSbElgNK5x6t6"}}}],"__typename":"Query"},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"variants-are-powerful"},"buildId":"FUc6KbB8ckVeA8vmTe0Az","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>